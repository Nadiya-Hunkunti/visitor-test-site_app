<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Visitor Tracking Test Website</title>
</head>
<body>

    <h1>Welcome to Visitor Tracking Demo</h1>
    <p>
        This is a test website.  
        Stay on this page for 20â€“30 seconds, then close the tab.
    </p>

    <!-- ðŸ”½ VISITOR TRACKING WITH LOCATION (ACCURATE & CONSENT-BASED) -->
    <script>
        let visitId = null;

        // Ask user for location permission
        navigator.geolocation.getCurrentPosition(
            (pos) => {
                // User ALLOWED location
                fetch("https://visitor-tracker-4dcw.onrender.com/track/start", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        page: window.location.href,
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude
                    })
                })
                .then(response => response.json())
                .then(data => {
                    visitId = data.visit_id;
                });
            },
            () => {
                // User DENIED location
                console.log("Location permission denied");

                // Still track visit WITHOUT location
                fetch("https://visitor-tracker-4dcw.onrender.com/track/start", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        page: window.location.href
                    })
                })
                .then(response => response.json())
                .then(data => {
                    visitId = data.visit_id;
                });
            }
        );

        // When page closes â†’ stop tracking
        window.addEventListener("beforeunload", function () {
            if (visitId) {
                navigator.sendBeacon(
                    "https://visitor-tracker-4dcw.onrender.com/track/end",
                    JSON.stringify({ visit_id: visitId })
                );
            }
        });
    </script>
    <!-- ðŸ”¼ VISITOR TRACKING SCRIPT END -->

</body>
</html>


